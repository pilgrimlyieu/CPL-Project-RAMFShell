# RAM File System Shell

> å¼ å“²æº(corax@smail.nju.edu.cn)  å†¯äºšæ—(191850036@smail.nju.edu.cn)

[TOC]

## å‰è¨€

åœ¨æœ¬æ¬¡é¡¹ç›®ä¸­ï¼ŒåŒå­¦ä»¬å°†ä¼šå°è¯•å®Œæˆä¸å¹³æ—¶ä½œä¸šä¸­ä¸åŒçš„ä»»åŠ¡ï¼šä½ ä¸æ˜¯åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­ç¼–å†™ä¸€ä¸ªå®Œæ•´çš„ç¨‹åºï¼Œè€Œæ˜¯æŒ‰ç…§è¦æ±‚å®Œå–„æˆ–å®ç°åˆ†å¸ƒåœ¨å¤šä¸ªæ–‡ä»¶ä¸­çš„å‡½æ•°ã€‚æµ‹è¯•ä»£ç ä¸­ä¼šè°ƒç”¨ä½ å®Œæˆçš„è¿™äº›å‡½æ•°ï¼Œä»¥æ£€æµ‹æ˜¯å¦å®Œæˆäº†é¢˜ç›®çš„è¦æ±‚ã€‚

å¦‚æœä½ åœ¨å®Œæˆä½œä¸šçš„è¿‡ç¨‹ä¸­æ„Ÿåˆ°å›°éš¾æˆ–ç–‘æƒ‘ï¼Œä¸å¦¨é€šè¿‡å·é¦–çš„é‚®ç®±ä¸åŠ©æ•™å–å¾—è”ç³»ä¸å¸®åŠ©ï¼Œè¯·åšæŒç‹¬ç«‹è‡ªä¸»å®Œæˆæœ¬æ¬¡ä½œä¸šğŸ˜Šï¼Œåœ¨æœ¬æ–‡æ¡£ä¸­æåˆ°äº†`è‡ªè¡Œ`çš„éƒ¨åˆ†ï¼Œé™¤éä½ å·²ç»èŠ±è´¹äº†ç›¸å½“çš„ç²¾åŠ›è¿›è¡Œæœç´¢ä¸ç ”ç©¶ä»æœªè§£å†³ï¼Œå¦åˆ™ä¸è¦è½»æ˜“æé—®ï¼Œè¿™æ— ç›Šäºä½ è‡ªå·±çš„èƒ½åŠ›æå‡ğŸ˜”ã€‚

## ç®€ä»‹

### èƒŒæ™¯çŸ¥è¯†

#### æ–‡ä»¶ç³»ç»Ÿ

æ–‡ä»¶ç³»ç»Ÿ([File System](https://en.wikipedia.org/wiki/File_system))æ˜¯æ“ä½œç³»ç»Ÿçš„é‡è¦ç»„æˆéƒ¨åˆ†ï¼Œå½“ä½ æ‰“å¼€Windowsç³»ç»Ÿçš„èµ„æºç®¡ç†å™¨ï¼Œä½ æ‰€çœ‹åˆ°çš„å°±æ˜¯ä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿçš„`UI`ç•Œé¢ã€‚é€šè¿‡è°ƒç”¨æ–‡ä»¶ç³»ç»Ÿæä¾›çš„æ¥å£ï¼Œæˆ‘ä»¬å°±å¯ä»¥å°†æ•°æ®æŒä¹…åŒ–åˆ°ç£ç›˜ä¸Šã€‚è€ŒCè¯­è¨€ä¸ºæˆ‘ä»¬æä¾›äº†ä¸€ç³»åˆ—æ¥å£ï¼Œä½¿ç¨‹åºå‘˜å¯ä»¥é€šè¿‡Cè¯­è¨€çš„æ¥å£ï¼ŒåŸºäºæ“ä½œç³»ç»Ÿå¯¹æ–‡ä»¶è¿›è¡Œæ“ä½œï¼Œä¾‹å¦‚ï¼š

```c
FILE *fopen(const char *pathname, const char *mode);
void fclose(FILE *fp);
size_t fwrite(const void *ptr, size_t size, size_t nmemb, FILE *stream);
size_t fread(void *ptr, size_t size, size_t nmemb, FILE *stream);
```

Linuxç¯å¢ƒä¸‹ï¼Œå®ƒä»¬æ˜¯é€šè¿‡è°ƒç”¨æ“ä½œç³»ç»Ÿçš„ä»¥ä¸‹æ¥å£æ¥å®Œæˆå¯¹åº”çš„åŠŸèƒ½çš„ï¼š<a name="RefToSysFunc"></a>

```c
int open(const char *pathname, int flags);
int close(int fd);
ssize_t write(int fd, const void *buf, size_t count);
ssize_t read(int fd, void *buf, size_t count);
off_t lseek(int fd, off_t offset, int whence);
int mkdir(const char *pathname, mode_t mode);
int rmdir(const char *pathname);
int unlink(const char *pathname);
```

æ³¨ï¼šä¸Šé¢çš„è¿™äº›æ¥å£ä½ åœ¨æœ¬æ¬¡ä½œä¸šä¸­åŸºæœ¬éƒ½ä¸ä¼šç”¨åˆ°ï¼Œ**ä½†é˜…è¯»æ‰‹å†Œå¹¶ç†Ÿæ‚‰å®ƒä»¬çš„åŠŸèƒ½å¯¹ä½ å®Œæˆé¡¹ç›®ç›¸å½“æœ‰ç›Š**ï¼Œå…³äºå¦‚ä½•é˜…è¯»å®ƒä»¬çš„æ‰‹å†Œï¼Œæˆ‘ä»¬ä¼šåœ¨ä¸‹æ–‡æåˆ°ã€‚

Linuxçš„æ–‡ä»¶ç³»ç»Ÿç»“æ„é‡‡ç”¨äº†æ ‘å½¢ç»“æ„ï¼Œå…·ä½“æè¿°å¦‚ä¸‹ï¼š

åˆå§‹çŠ¶æ€ä¸‹åªå­˜åœ¨æ ¹ç›®å½•/ï¼Œæ–‡ä»¶ç³»ç»Ÿä¸­å­˜åœ¨ä¸¤ç±»å¯¹è±¡ï¼šç›®å½•å’Œæ–‡ä»¶ã€‚ç›®å½•ä¸‹å¯ä»¥å­˜æ”¾å…¶ä»–å¯¹è±¡ï¼Œè€Œæ–‡ä»¶ä¸å¯ä»¥ï¼Œå³åœ¨Linuxæ–‡ä»¶ç³»ç»Ÿçš„æ ‘å½¢ç»“æ„ä¸­ï¼Œæ–‡ä»¶åªèƒ½æ˜¯å¶èŠ‚ç‚¹ã€‚ä¾‹å¦‚ï¼š

```
/
â”œâ”€â”€ 1.txt 		"/1.txt"
â”œâ”€â”€ 2.txt 		"/2.txt"
â””â”€â”€ dir 		"/dir"
	â”œâ”€â”€ 1.txt 	"/dir/1.txt"
	â””â”€â”€ 2.txt 	"/dir/2.txt"

```

å¯ä»¥çœ‹åˆ°ï¼Œåœ¨æ ¹â½¬å½•ä¸‹â¼€å…±æœ‰3ä¸ªé¡¹â½¬ï¼šä¸¤ä¸ªâ½‚ä»¶ï¼Œâ¼€ä¸ªâ½¬å½•dirï¼Œâ½½dirä¸‹è¿˜å¯ä»¥æ‹¥æœ‰ä¸¤ä¸ªâ½‚ä»¶ã€‚å³ä¾§çš„å­—ç¬¦ä¸²ç§°ä¸ºå¯¹è±¡çš„â€œç»å¯¹è·¯å¾„â€ã€‚

éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨Linuxç³»ç»Ÿä¸‹ï¼Œå¦‚æœç»å¯¹è·¯å¾„æŒ‡ç¤ºç›®å½•ï¼Œåˆ™å®ƒçš„æ¯ä¸€ä¸ª/éƒ½å¯ä»¥è¢«æ›¿æ¢ä¸ºå¤šä½™çš„æ•°ä¸ª/ï¼Œä¸¤è€…è¡¨æ„ç›¸åŒï¼Œä¸”æœ«å°¾ä¹Ÿå¯ä»¥æ·»åŠ æ•°ä¸ª/ï¼Œä¾‹å¦‚///dir////ï¼›å¦‚æœç»å¯¹è·¯å¾„æŒ‡ç¤ºæ–‡ä»¶ï¼Œåˆ™é™¤äº†æœ«å°¾ä¸å¯ä»¥æ·»åŠ /ï¼Œå¦åˆ™è§†ä¸ºç›®å½•ï¼Œè·¯å¾„ä¸­é—´çš„æ‰€æœ‰/éƒ½å¯ä»¥å†—ä½™ï¼Œä¾‹å¦‚///dir///1.txtã€‚ä½ ä¸å¦¨è‡ªè¡Œåœ¨Linuxç¯å¢ƒä¸‹å°è¯•è¿™ä¸€ç‚¹ï¼Œä½†æ˜¯éœ€è¦æŒ‡å‡ºçš„æ˜¯ï¼ŒLinuxç³»ç»Ÿä¼šå¯¹/å’Œ//è¿›è¡ŒåŒºåˆ†ï¼Œä½†å®é™…ä¸Šå´æ˜¯åŒä¸€ç›®å½•**ï¼Œåœ¨æœ¬æ¬¡é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬ä¸è€ƒè™‘//çš„å­˜åœ¨ï¼Œä¸€å¾‹è§†ä¸º/ï¼ŒåŒæ—¶ï¼Œæœ¬æ¬¡é¡¹ç›®ä¸­çš„ç›®å½•ä¸æ–‡ä»¶åå¦‚æœå«æœ‰å­—æ¯ï¼Œæ•°å­—å’Œ`.`ä¹‹å¤–çš„å­—ç¬¦å‡è§†ä¸ºéæ³•å–å€¼**ã€‚

$\color{red}âš åœ¨æœ¬æ¬¡é¡¹ç›®ä¸­ï¼Œå…³äºæ–‡ä»¶ç³»ç»Ÿçš„éƒ¨åˆ†æ²¿ç”¨ä¸Šè¿°è¯´æ˜ã€‚å¹¶ä¸”ä¸ç”¨è€ƒè™‘ç›¸å¯¹è·¯å¾„ (.å’Œ..)ï¼Œæ‰€æœ‰è¾“å…¥å‡ä¸ºç»å¯¹è·¯å¾„ã€‚$

#### Shell

Shellæ˜¯**ç”¨æˆ·ä¸æ“ä½œç³»ç»Ÿå†…æ ¸ä¹‹é—´çš„æ¥å£**ï¼Œé€šè¿‡è¿™ä¸ªæ¥å£ï¼Œä½ å¯ä»¥æŒ‰ç…§ä¸€å®šçš„æ–¹å¼è·å–æ“ä½œç³»ç»Ÿæä¾›çš„æœåŠ¡ï¼Œå…¶ä¸­å¾ˆé‡è¦çš„ä¸€éƒ¨åˆ†å°±æ˜¯å¯¹æ–‡ä»¶ç³»ç»Ÿçš„è®¿é—®ä¸æ“ä½œã€‚

ä»€ä¹ˆæ˜¯ç”¨æˆ·ä¸æ“ä½œç³»ç»Ÿå†…æ ¸ä¹‹é—´çš„æ¥å£ï¼Ÿç°åœ¨åŒå­¦ä»¬ä½¿ç”¨ç”µè„‘åŸºæœ¬ä¸Šéƒ½æ˜¯åœ¨é€šè¿‡å›¾å½¢åŒ–ç•Œé¢(Graphical User Interface)ä¸æ“ä½œç³»ç»Ÿå†…æ ¸è¿›è¡Œäº¤äº’ï¼Œè¿™å°±æ˜¯ä¸€ç§ç”¨æˆ·ä¸æ“ä½œç³»ç»Ÿå†…æ ¸ä¹‹é—´çš„æ¥å£ã€‚è€Œåœ¨æ›´æ—©ä¹‹å‰ï¼Œè®¡ç®—æœºä½¿ç”¨è€…ä½¿ç”¨å­—ç¬¦ç•Œé¢ä¸æ“ä½œç³»ç»Ÿè¿›è¡Œäº¤äº’ï¼Œç°åœ¨ShellåŸºæœ¬å°±ç‰¹æŒ‡è¿™ç§å­—ç¬¦ç•Œé¢çš„äº¤äº’æ–¹å¼ã€‚ä¸¾ä¸ªä¾‹å­ï¼ŒLinuxç³»ç»Ÿå¸¸ç”¨çš„Shellæœ‰sh, bashç­‰ï¼ŒWindowså¸¸ç”¨çš„Shellæœ‰powershellã€‚

### é¡¹ç›®æ¦‚è¦

#### ä»»åŠ¡è¯´æ˜

åœ¨æœ¬æ¬¡ä½œä¸šä¸­ï¼Œæˆ‘ä»¬éœ€è¦ä½ åœ¨å†…å­˜(Random Access Memory, RAM)ä¸Š**æ¨¡æ‹Ÿ**ä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿï¼Œå³å°†æ•°æ®æŒä¹…åŒ–åˆ°å†…å­˜ä¸Šï¼Œè€Œä¸æ˜¯ç£ç›˜çš„ä¸»å­˜(Memory)ä¸Šï¼Œè¿™æ˜¯ä¸€ä¸ªæ˜“å¤±æ€§çš„æ–‡ä»¶ç®¡ç†ç³»ç»Ÿï¼›åŒæ—¶ï¼Œæˆ‘ä»¬è¿˜éœ€è¦ä½ **æ¨¡æ‹Ÿ**ä¸€ä¸ªä¸å®Œæ•´çš„Shellï¼Œå®ç°å¯¹ä½ æ¨¡æ‹Ÿçš„æ–‡ä»¶ç³»ç»Ÿçš„è®¿é—®ä¸æ“ä½œï¼Œè¿™åŒ…æ‹¬ä¸€äº›åŸºç¡€å‘½ä»¤ï¼Œä¾‹å¦‚`ls`ï¼Œ`cat`ç­‰ã€‚

#### å‰æƒ…æè¦

æˆ‘ä»¬æ¨èä½ åœ¨Linuxæ“ä½œç³»ç»Ÿä¸Šå®Œæˆæœ¬æ¬¡é¡¹ç›®ã€‚å¦‚ä½•è·å–Linuxç¯å¢ƒï¼šï¼ˆæ¨èé¡ºåºä»ä¸Šåˆ°ä¸‹ï¼‰

1. å¦‚æœä½ æœ‰å¤šä½™å¹¶ä¸”æ€§èƒ½ä¸ç®—å¤ªå·®çš„ç”µè„‘ï¼Œæˆ‘ä»¬ååˆ†æ¨èä½ å¤‡ä»½æ•°æ®åå®‰è£…Linuxæ“ä½œç³»ç»Ÿè·å–åŸç”Ÿä½“éªŒï¼ˆæœ‰ä¸€å®šéš¾åº¦ï¼‰ã€‚
2. ä½ å¯ä»¥é€šè¿‡Windowså®˜æ–¹æä¾›çš„wsl(Windows Subsystem for Linux)æ¥è·å–éåŸç”ŸLinuxç¯å¢ƒï¼Œå°½ç®¡éåŸç”Ÿï¼Œä½†ä¹Ÿç›¸å½“å¤Ÿç”¨ï¼Œæ³¨æ„ä½¿ç”¨æ­¤æ–¹å¼ä½ å‡ ä¹**åªèƒ½ä½¿ç”¨Shell**è¿›è¡Œäº¤äº’ï¼ˆå…¶ä»–æ–¹å¼éƒ½å¯ä»¥ä½¿ç”¨å›¾å½¢ç•Œé¢å’ŒShellï¼‰ï¼Œä½†è¿™å¯¹ä½ å®Œæˆä½œä¸šä¹Ÿæœ‰æ‰€å¸®åŠ©ã€‚ä½ å¯ä»¥é€šè¿‡[è¿™ä¸ªé“¾æ¥](https://oi-wiki.org/tools/wsl/)æ¥æŸ¥çœ‹å®‰è£…æ•™ç¨‹ï¼Œä½†è¿‡ç¨‹ä¸­é‡åˆ°çš„æ›´å¤šé—®é¢˜éœ€è¦ä½ è‡ªè¡ŒSTFW/RTFMã€‚
3. ä½ å¯ä»¥é€šè¿‡å®‰è£…è™šæ‹Ÿæœºè½¯ä»¶æ¥è·å–åŸç”ŸLinuxä½“éªŒï¼Œä½†å…·ä½“å¦‚ä½•æ“ä½œéœ€è¦ä½ è‡ªè¡Œæ£€ç´¢ã€‚
4. ä¸è¦è½»æ˜“å°è¯•åŒç³»ç»Ÿï¼ˆä¸æ¨èï¼‰ã€‚

$\color{red}{âš å¦‚æœä½ åšæŒä½¿ç”¨Windowsç¯å¢ƒï¼Œé‚£ä¹ˆä½ é‡åˆ°çš„æ‰€æœ‰é—®é¢˜éƒ½å°†ç”±ä½ è‡ªå·±è´Ÿè´£å¹¶è§£å†³ï¼}$

## å¼€å§‹ä½ çš„é¡¹ç›®

### è·å–é¡¹ç›®æ¡†æ¶

æˆ‘ä»¬ä¸ºä½ å‡†å¤‡äº†ä¸€ä¸ªgitä»“åº“ï¼Œè¯·åŸºäºè¿™ä¸ªgitä»“åº“å®Œæˆä½ çš„é¡¹ç›®ã€‚å¦‚æœä½ ä¸ä¼šä½¿ç”¨gitï¼Œè¯·è‡ªè¡Œæ£€ç´¢å¹¶å­¦ç€ä½¿ç”¨ã€‚

ä½ å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤æ¥è·å–é¡¹ç›®æ¡†æ¶ï¼š

```shell
git clone https://git.nju.edu.cn/KYCoraxxx/ramfshell.git
```

è¯·åœ¨é»˜è®¤çš„masteråˆ†æ”¯ä¸Šå®Œæˆä½ çš„ä½œä¸šï¼Œæœ€ç»ˆOJçš„è¯„åˆ†ä¹Ÿå°†ä»¥masteråˆ†æ”¯ä¸Šçš„å†…å®¹ä¸ºå‡†ã€‚

åœ¨è¿™ä¸ªä»“åº“ä¸­æˆ‘ä»¬ä¸ºä½ æä¾›äº†ä¸€ä¸ªè‡ªåŠ¨ç¼–è¯‘è„šæœ¬`Makefile`ï¼Œå¹¶ä¸”ä¸ºä½ é…ç½®å¥½äº†è®°å½•è‡ªåŠ¨è¿½è¸ªï¼Œè¯·ä¸è¦éšæ„ä¿®æ”¹`Makefile`ï¼Œé™¤éä½ æ¸…æ¥šä½ åœ¨å¹²ä»€ä¹ˆï¼Œä½ çš„ä¿®æ”¹è®°å½•å°†æˆä¸ºæŸ¥é‡æ—¶è¯æ˜ç‹¬â½´å®Œæˆçš„é‡è¦è¯æ®ã€‚

### é¡¹ç›®æ¡†æ¶å¯¼è¯»

é¡¹ç›®çš„æ•´ä½“æ¡†æ¶å¦‚ä¸‹ï¼š

```
/ramfs-shell
â”œâ”€â”€ .gitignore
â”œâ”€â”€ Makefile
â”œâ”€â”€ README.md
â”œâ”€â”€ main.c
â”œâ”€â”€ include
|	â”œâ”€â”€ ramfs.h
|	â””â”€â”€ shell.h
â”œâ”€â”€ fs
|	â””â”€â”€ ramfs.c
â””â”€â”€ sh
	â””â”€â”€ shell.c
```

1. .gitignoreæ–‡ä»¶ç”¨äºgitä»“åº“æäº¤ï¼Œè¯·ä¸è¦éšæ„ä¿®æ”¹ï¼Œé™¤éä½ çŸ¥é“ä½ åœ¨åšä»€ä¹ˆï¼Œå¦åˆ™å¯èƒ½å‡ºç°æäº¤å¤±è´¥çš„é”™è¯¯ï¼›
2. Makefileæ˜¯æˆ‘ä»¬ä¸ºä½ æä¾›çš„è‡ªåŠ¨ç¼–è¯‘è„šæœ¬ï¼Œå¦‚å‰æ–‡æ‰€è¿°ï¼›
3. ä½ æ­£åœ¨é˜…è¯»çš„æ˜¯README.mdï¼ˆä¹Ÿæœ‰å¯èƒ½æ˜¯å®ƒå¯¼å‡ºçš„pdfï¼‰ï¼›
4. main.cç”¨äºè¿›è¡Œæµ‹è¯•ï¼›
5. includeæ–‡ä»¶å¤¹ä¸­åŒ…å«äº†æ‰€æœ‰çš„å¤´æ–‡ä»¶ï¼›
6. fsæ–‡ä»¶å¤¹ä¸­åŒ…å«äº†RAM File Systemçš„æ ¸å¿ƒä»£ç ï¼Œä½ éœ€è¦å®ç°å…¶ä¸­å°šæœªå®Œæˆçš„å‡½æ•°ï¼›
7. shæ–‡ä»¶å¤¹ä¸­åŒ…å«äº†Shellçš„æ ¸å¿ƒä»£ç ï¼Œä½ éœ€è¦å®ç°å…¶ä¸­å°šæœªå®Œæˆçš„å‡½æ•°ã€‚

### é¡¹ç›®å¼•å¯¼

#### å‰æƒ…æè¦

æœ¬å¼•å¯¼æ—¨åœ¨ä¸ºå®Œæˆæœ¬æ¬¡é¡¹ç›®æœ‰å›°éš¾çš„åŒå­¦æä¾›æ€è·¯ï¼Œä¸ºäº†åœ¨å®Œæˆé¡¹ç›®è¿‡ç¨‹ä¸­å­¦ä¹ åˆ°æ›´å¤šçŸ¥è¯†ä¸èƒ½åŠ›ï¼Œä½ åº”è¯¥**å°½å¯èƒ½å‡å°‘ç›´æ¥é˜…è¯»**æ­¤éƒ¨åˆ†ä¸­`æ”»ç•¥`ï¼ˆä¼šåœ¨åç»­å†…å®¹ä¸­è¿›è¡Œæ ‡æ³¨ï¼‰çš„å†…å®¹ï¼Œ**è€Œæ˜¯å…ˆé˜…è¯»æ¯ä¸ªå‡½æ•°çš„å®ç°è¦æ±‚ï¼Œç„¶åé˜…è¯»å¼•å¯¼ä¸­æ ‡æ³¨çš„å®˜æ–¹æ–‡æ¡£ï¼Œè¯†åˆ«å‡ºæœ‰å“ªäº›å…·ä½“å†…å®¹æ˜¯éœ€è¦ä½ è‡ªå·±å®ç°çš„ï¼Œæ¥ä¸‹æ¥è‡ªå·±å®ç°ï¼Œé‡åˆ°äº†é—®é¢˜å†é˜…è¯»æ”»ç•¥å†…å®¹**ã€‚

$\color{red}æ”»ç•¥çš„å…·ä½“å†…å®¹æš‚æ—¶ä¸ä¼šæ›´æ–°ï¼ŒåæœŸè§†åŒå­¦ä»¬çš„å®Œæˆæƒ…å†µæ”¾å‡º(ä¼šå°½å¯èƒ½è®©é€‰é¢˜å¹¶è®¤çœŸå¯¹å¾…çš„åŒå­¦å®Œæˆä½œä¸šæ‹¿åˆ°åˆ†æ•°)$

$\color{red}åŒæ—¶ï¼Œéœ€è¦å®Œæˆå†…å®¹ä¸­å…³äºé”™è¯¯å¤„ç†çš„æè¿°åªæ˜¯å¿…è¦çš„ï¼Œä½ å¯ä»¥è‡ªè¡Œè¯†åˆ«åœ¨è¯¥é¡¹ç›®ä¸­è¿˜èƒ½å¤„ç†å“ªäº›é”™è¯¯ï¼Œä»¥æé«˜ç¨‹åºçš„é²æ£’æ€§$

#### æ–‡ä»¶ç³»ç»Ÿéƒ¨åˆ†

##### æ•°æ®ç»“æ„è®¾è®¡

###### æ–‡ä»¶èŠ‚ç‚¹

åœ¨å†…å­˜æ–‡ä»¶ç³»ç»Ÿä¸­ï¼Œä½ éœ€è¦ä¸€ä¸ªæ•°æ®ç»“æ„æ¥å­˜å‚¨ä¸€ä¸ª**æ–‡ä»¶**çš„ä¿¡æ¯ï¼ˆæˆ‘ä»¬æ²¿ç”¨äº†Linuxä¸­â€œEverything is a fileâ€çš„è®¾è®¡ï¼‰ï¼ŒåŒ…æ‹¬è¿™ä¸ª**æ–‡ä»¶çš„ç±»å‹**ï¼ˆæ˜¯æ™®é€šæ–‡ä»¶è¿˜æ˜¯ç›®å½•ï¼‰ï¼Œ**åç§°**ï¼›å¦‚æœå®ƒæ˜¯ä¸€ä¸ªæ™®é€šæ–‡ä»¶ï¼Œåˆ™å®ƒçš„**æ–‡ä»¶å†…å®¹**ã€**æ–‡ä»¶å¤§å°**ä¹Ÿå€¼å¾—æˆ‘ä»¬å…³æ³¨ï¼›å¦‚æœå®ƒæ˜¯ä¸€ä¸ªç›®å½•ï¼Œåˆ™å®ƒæœ‰å“ªäº›**å­èŠ‚ç‚¹**ä¹Ÿå€¼å¾—æˆ‘ä»¬å…³æ³¨ã€‚è¿™é‡Œæˆ‘ä»¬ç»™å‡ºä¸€ä¸ªå¯ä¾›å‚è€ƒçš„æ•°æ®ç»“æ„ï¼Œå®ƒå¯¹åº”äº†ä¸Šæ–‡ä¸­æˆ‘ä»¬å…³æ³¨çš„æ–‡ä»¶ä¿¡æ¯ï¼Œä½ å¯ä»¥è¯•ç€è‡ªå·±ç†è§£è¿™äº›å­—æ®µçš„å«ä¹‰ï¼Œ**ä¹Ÿå¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€è¦è®¾è®¡è‡ªå·±çš„æ•°æ®ç»“æ„**ï¼š

```c
typedef struct node {
    enum { FILE_NODE, DIR_NODE } type;
    struct node *dirents;
    void *content;
    int nrde;
    int size;
    char *name;
} node;
```

###### æ–‡ä»¶æè¿°ç¬¦

åœ¨Linuxç³»ç»Ÿä¸­ï¼Œå½“ä½ æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶ï¼Œå°±ä¼šå¾—åˆ°è¿™ä¸ªæ–‡ä»¶çš„ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼ˆFile Descriptorï¼‰ï¼Œç”¨äºå¯¹æ–‡ä»¶è¿›è¡Œè¯»å†™ã€‚å¯¹äºæ–‡ä»¶æè¿°ç¬¦è€Œè¨€ï¼Œå®ƒé‡è¦çš„å±æ€§åŒ…å«ï¼š**è¯»å†™æ€§è´¨**ï¼ˆæ”¯æŒå¯¹æ–‡ä»¶è¿›è¡Œçš„æ“ä½œï¼Œä¾‹å¦‚åªè¯»ã€åªå†™ç­‰ï¼‰ã€**åç§»é‡**ã€**å¯¹åº”çš„æ–‡ä»¶**ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬å°†å¯¹**è¯»å†™æ€§è´¨**ã€**åç§»é‡**åšå‡ºè¿›ä¸€æ­¥çš„è¯´æ˜ã€‚

**åç§»é‡ (offsetï¼‰**

æƒ³è±¡ä½ â½¤â¼¿æŒ‡æŒ‡ç€è¯»â¼€æœ¬ä¹¦ï¼Œoffset ç›¸å½“äºä½ â¼¿æŒ‡æŒ‡å‘çš„ä½ç½®ã€‚ä½ æ¯è¯»â¼€ä¸ªå­—ï¼Œâ¼¿æŒ‡å°±å‘å‰å‰è¿›â¼€ä¸ªå­—ï¼›å¦‚æœä½ æƒ³æ”¹å†™ä¹¦æœ¬ä¸Šçš„å­—ï¼Œæ¯æ”¹å†™â¼€ä¸ªå­—ï¼Œâ¼¿æŒ‡ä¹Ÿå‘å‰å‰è¿›â¼€ä¸ªå­—ã€‚ 

æ¯â¼€ä¸ªâ½‚ä»¶æè¿°ç¬¦éƒ½æ‹¥æœ‰â¼€ä¸ªåç§»é‡ï¼Œâ½¤æ¥æŒ‡â½°è¯»å’Œå†™æ“ä½œçš„å¼€å§‹ä½ç½®ã€‚è¿™ä¸ªåç§»é‡å¯¹åº”çš„æ˜¯â½‚ä»¶æè¿°ç¬¦ï¼Œâ½½ä¸æ˜¯â€œâ½‚ä»¶â€å¯¹è±¡ã€‚ä¹Ÿå°±æ˜¯è¯´å¦‚æœä¸¤æ¬¡æ‰“å¼€åŒä¸€ä¸ªæ–‡ä»¶ï¼Œä½ å°†å¾—åˆ°ä¸¤ä¸ªä¸åŒçš„æ–‡ä»¶æè¿°ç¬¦ï¼Œå®ƒä»¬ä¹‹é—´çš„åç§»é‡ç›¸äº’ç‹¬ç«‹ï¼Œå…·ä½“è€Œè¨€ï¼Œä½ å¯ä»¥è€ƒè™‘ä¸‹é¢çš„ä»£ç ï¼š

```c
// å‡è®¾1.txtæ–‡ä»¶ä¸­çš„å†…å®¹æ˜¯helloworld
char buf[10];
int fd1 = open("/1.txt", O_RDONLY);
int fd2 = open("/1.txt", O_RDONLY);
read(fd1, buf, 6); //ä»fd1ä¸­è¯»å–6ä¸ªå­—èŠ‚å­˜å‚¨åˆ°bufä¸­
read(fd2, buf, 6); //ä»fd2ä¸­è¯»å–6ä¸ªå­—èŠ‚å­˜å‚¨åˆ°bufä¸­
// ä¸¤æ¬¡è¯»å–çš„ç»“æœåº”è¯¥æ˜¯ç›¸åŒçš„
```

éœ€è¦æ³¨æ„çš„æ˜¯åœ¨è¯»å–è¿‡ç¨‹ä¸­ï¼Œåç§»é‡å¯ä»¥è¶…è¿‡åŸæ–‡ä»¶çš„å¤§å° (size)ï¼Œå³æŒ‡åˆ°æ–‡ä»¶æœ«å°¾ä¹‹åçš„ä½ç½®ã€‚ä½†æ˜¯ä¸€æ—¦å¼€å§‹åœ¨æ–‡ä»¶æœ«å°¾ä¹‹åçš„ä½ç½®å¼€å§‹å†™å…¥ï¼Œä½ å°±éœ€è¦å°†æ–‡ä»¶è¿›è¡Œæ‰©å®¹ï¼Œå¹¶ä¸”ç”¨`\0`å¡«å……ä¸­é—´çš„é—´éš™ã€‚

**è¯»å†™æ€§è´¨**

å¦‚æœä½ é˜…è¯»äº†ramfs.hï¼Œä½ ä¼šå‘ç°å…¶ä¸­å­˜åœ¨è¿™äº›å¸¸é‡ï¼š

```c
#define O_APPEND 02000
#define O_CREAT 0100
#define O_TRUNC 01000
#define O_RDONLY 00
#define O_WRONLY 01
#define O_RDWR 02
```

è¿™äº›æ ‡å¿—å¸¸é‡å°±æ˜¯ç”¨æ¥æŒ‡ç¤ºè¯»å†™æ€§è´¨çš„ï¼Œå…¶ä¸­ä»¥0å¼€å¤´çš„æ•°å­—åœ¨Cè¯­è¨€ä¸­è¡¨ç¤º8è¿›åˆ¶ï¼Œå®ƒä»¬çš„å«ä¹‰å¦‚ä¸‹ï¼š

- O_APPEND (02000): ä»¥è¿½åŠ æ¨¡å¼æ‰“å¼€æ–‡ä»¶ï¼Œå³æ‰“å¼€æ–‡ä»¶åï¼Œæ–‡ä»¶æè¿°ç¬¦çš„åç§»é‡æŒ‡å‘æ–‡ä»¶çš„æœ«å°¾ï¼Œè‹¥ä¸å«æ­¤æ ‡å¿—ï¼Œåˆ™æŒ‡å‘æ–‡ä»¶çš„å¼€å¤´ï¼›å¦‚æœè¯¥æ ‡å¿—å•ç‹¬å‡ºç°é»˜è®¤å¯è¯»
- O_CREAT (0100): å¦‚æœä¼ å…¥çš„æ–‡ä»¶è·¯å¾„ä¸å­˜åœ¨ï¼Œå°±åˆ›å»ºè¿™ä¸ªæ–‡ä»¶ï¼Œä½†å¦‚æœè¿™ä¸ªæ–‡ä»¶çš„çˆ¶ç›®å½•ä¸å­˜åœ¨ï¼Œå°±åˆ›å»ºå¤±è´¥ï¼›å¦‚æœæ–‡ä»¶å·²å­˜åœ¨å°±æ­£å¸¸æ‰“å¼€
- O_TRUNC (01000): å¦‚æœä¼ å…¥çš„æ–‡ä»¶è·¯å¾„æ˜¯å­˜åœ¨çš„æ–‡ä»¶ï¼Œå¹¶ä¸”åŒæ—¶è¿˜å¸¦æœ‰å¯å†™ï¼ˆO_WRONLYå’ŒO_RDWRï¼‰çš„æ ‡å¿—ï¼Œå°±æ¸…ç©ºè¿™ä¸ªæ–‡ä»¶
- O_RDONLY (00): ä»¥åªè¯»çš„æ–¹å¼æ‰“å¼€æ–‡ä»¶
- O_WRONLY (01): ä»¥åªå†™çš„æ–¹å¼æ‰“å¼€æ–‡ä»¶
- O_RDWR (02): ä»¥å¯è¯»å¯å†™çš„æ–¹å¼æ‰“å¼€æ–‡ä»¶

èªæ˜çš„ä½ åœ¨é˜…è¯»çš„è¿‡ç¨‹ä¸­åº”è¯¥å‘ç°ï¼šå‰ä¸‰ä¸ªæ ‡å¿—æ˜¯å¯ä»¥å’Œå…¶ä»–æ ‡å¿—è¿›è¡Œç»“åˆçš„ï¼Œè€Œå®ƒä»¬åœ¨äºŒè¿›åˆ¶è¡¨ç¤ºä¸‹ï¼Œ1çš„ä½ç½®æ€»æ˜¯ä¸åŒçš„ã€‚å¾ˆè‡ªç„¶çš„ï¼Œä½ ä¼šè”æƒ³åˆ°å®ƒä»¬å¯ä»¥é€šè¿‡**æŒ‰ä½æˆ–**è¿ç®—è¿›è¡Œç»“åˆï¼Œè€Œäº‹å®ä¹Ÿæ­£æ˜¯å¦‚æ­¤ã€‚ç„¶è€Œï¼Œæœ‰çš„æ ‡å¿—ä¹‹é—´çš„ç»„åˆåœ¨è¯­ä¹‰ä¸Šæ˜¯çŸ›ç›¾çš„ï¼Œæˆ‘ä»¬å°†å¯¹è¿™äº›ç»„åˆè¿›è¡Œè¯´æ˜ï¼š

- O_TRUNC | O_RDONLYåœ¨Linuxç³»ç»Ÿä¸­æ˜¯Unspecifiedè¡Œä¸ºï¼Œåœ¨æœ¬æ¬¡é¡¹ç›®ä¸­æˆ‘ä»¬çº¦å®šæ­¤æ ‡å¿—ç»„åˆçš„è¡Œä¸ºä¸ºæ­£å¸¸åªè¯»æ‰“å¼€ï¼Œè€Œä¸æ¸…ç©ºæ–‡ä»¶
- O_RDWR | O_WRONLYå–åªå†™çš„è¯­ä¹‰
- å¦‚æœä¼ å…¥çš„å‚æ•°æ²¡æœ‰æŒ‡å®šä»»ä½•æ ‡å¿—ï¼Œåˆ™é»˜è®¤åªè¯»ï¼ˆè¿™ä¸O_RDONLYå–å€¼ä¸º0ä¹Ÿæœ‰å…³ç³»ï¼‰
- O_RDONLY | O_WRONLYå–åªå†™çš„è¯­ä¹‰

##### init_ramfs

è¯¥å‡½æ•°ä¸ºRAM File Systemçš„åˆå§‹åŒ–å‡½æ•°ï¼Œä½ å¯ä»¥åœ¨å…¶ä¸­**è‡ªç”±å®Œæˆ**å¯¹å†…å­˜æ–‡ä»¶ç³»ç»Ÿçš„åˆå§‹åŒ–ï¼Œæ¯”å¦‚åˆ›å»ºæ ¹ç›®å½•ç­‰ï¼Œæˆ‘ä»¬çš„æµ‹è¯•ä»£ç ä¸­ä¼šæœ€å…ˆè°ƒç”¨æ­¤å‡½æ•°ã€‚

##### find

è¯¥å‡½æ•°ä¸ºè¾…åŠ©å‡½æ•°ï¼Œç”¨äºå¯»æ‰¾pathnameå¯¹åº”çš„æ–‡ä»¶èŠ‚ç‚¹ï¼Œç”±äºåœ¨Shellä¸­ä¹Ÿéœ€è¦ä½¿ç”¨ï¼Œæ‰€ä»¥æå‰ä¸ºåŒå­¦ä»¬å£°æ˜ï¼Œä½†å®ƒä¸å¯¹åº”ä»»ä½•æ–‡æ¡£ï¼Œä½ å¯ä»¥**è‡ªç”±å®ç°å®ƒçš„å†…å®¹ï¼Œä½†è¦æ–¹ä¾¿ä½ å®Œæˆä¸‹é¢å„å‡½æ•°çš„å®ç°**ã€‚

##### run_link

è¯¥å‡½æ•°å¯¹åº”äº[å‰æ–‡](#RefToSysFunc)æåˆ°çš„`unlink`å‡½æ•°ï¼Œåœ¨Linuxç³»ç»Ÿä¸‹ä½ å¯ä»¥åˆ©ç”¨å‘½ä»¤`man 2 unlink`æŸ¥çœ‹å…¶æ–‡æ¡£ã€‚

> ä½ å¯ä»¥è‡ªè¡Œæœç´¢å­¦ä¹ å¦‚ä½•åœ¨è¯¥ç•Œé¢ä¸‹æµè§ˆæ–‡æ¡£å†…å®¹ï¼Œä¹Ÿå¯ä»¥é€šè¿‡é‡å®šå‘`man 2 unlink > unlink.txt`å¹¶å°†unlink.txtæ–‡ä»¶å¤åˆ¶åˆ°å›¾å½¢ç•Œé¢ä¸‹æ›´å¥½åœ°é˜…è¯»ï¼Œä¹Ÿå¯ä»¥åœ¨äº’è”ç½‘ä¸Šæœç´¢ç›¸å…³æ–‡æ¡£ï¼ˆä½†ä½ æ— æ³•ä¿è¯äº’è”ç½‘ä¸Šçš„æè¿°æ˜¯æ­£ç¡®çš„ï¼ŒåŒç†ï¼Œè¯·å°½å¯èƒ½é˜…è¯»æ‰‹å†ŒåŸæ–‡è€Œä¸è¦é˜…è¯»ç¿»è¯‘ï¼‰ã€‚å„ä¸ªå‡½æ•°æ–‡æ¡£çš„æŸ¥çœ‹æ–¹å¼å¤§åŒå°å¼‚ï¼Œæ­¤æ®µè¯åœ¨ä¹‹åçš„å‡½æ•°ä¸­å°†ä¸å†èµ˜è¿°ã€‚

**ä½ éœ€è¦å®ç°çš„å†…å®¹åŒ…å«ï¼šä»…æ–‡æ¡£ä¸­æœ‰å…³æ–‡ä»¶çš„éƒ¨åˆ†ï¼Œä¸éœ€è¦è€ƒè™‘æ˜¯å¦æœ‰æ–‡ä»¶æè¿°ç¬¦æ­£åœ¨ä½¿ç”¨è¯¥æ–‡ä»¶ï¼Œæµ‹è¯•æ•°æ®ä¿è¯ä¸ä¼šå†ä½¿ç”¨å’Œå·²ç»è¢«åˆ å»çš„æ–‡ä»¶ç›¸å…³çš„æ–‡ä»¶æè¿°ç¬¦ã€‚è¯·ç‰¹åˆ«å…³æ³¨è¿”å›å€¼æè¿°ï¼Œå¹¶å¯¹ä¸åˆç†çš„è¾“å…¥åšåˆé€‚çš„å¤„ç†ï¼Œå…·ä½“è€Œè¨€ï¼Œä½ éœ€è¦é’ˆå¯¹æ–‡æ¡£ä¸­`EISDIR`å’Œ`ENOENT`ï¼ˆä¸éœ€è¦å¤„ç†dangling symbolic linkï¼Œè¯¥å†…å­˜æ–‡ä»¶ç³»ç»Ÿä¸­ä¹Ÿä¸å­˜åœ¨è¿™ä¸ªä¸œè¥¿ï¼‰çš„æè¿°è¿›è¡Œé”™è¯¯å¤„ç†ã€‚**

##### rrmdir

è¯¥å‡½æ•°å¯¹åº”äº[å‰æ–‡](#RefToSysFunc)æåˆ°çš„`rmdir`å‡½æ•°ï¼Œåœ¨Linuxç³»ç»Ÿä¸‹ä½ å¯ä»¥åˆ©ç”¨å‘½ä»¤`man 2 rmdir`æŸ¥çœ‹å…¶æ–‡æ¡£ã€‚

**ä½ éœ€è¦å®ç°çš„å†…å®¹åŒ…å«ï¼šæ–‡æ¡£ä¸­çš„å®Œæ•´æè¿°ï¼ˆå°±ä¸€å¥è¯ï¼‰ã€‚è¯·ç‰¹åˆ«å…³æ³¨è¿”å›å€¼æè¿°ï¼Œå¹¶å¯¹ä¸åˆç†çš„è¾“å…¥åšåˆé€‚çš„å¤„ç†ï¼Œå…·ä½“è€Œè¨€ï¼Œä½ éœ€è¦é’ˆå¯¹æ–‡æ¡£ä¸­`ENONENT`,`ENOTDIR`,`ENOTEMPTY`,`EACCESS`ï¼ˆåªç”¨è€ƒè™‘ä¸€ä¸ªç‰¹æ®Šæƒ…å†µï¼‰çš„æè¿°è¿›è¡Œé”™è¯¯å¤„ç†ã€‚**

##### rmkdir

è¯¥å‡½æ•°å¯¹åº”äº[å‰æ–‡](#RefToSysFunc)æåˆ°çš„`mkdir`å‡½æ•°ï¼Œåœ¨Linuxç³»ç»Ÿä¸‹ä½ å¯ä»¥åˆ©ç”¨å‘½ä»¤`man 2 mkdir`æŸ¥çœ‹å…¶æ–‡æ¡£ã€‚

**ä½ éœ€è¦å®ç°çš„å†…å®¹åŒ…å«ï¼šä»…æ–‡æ¡£ä¸­çš„ç¬¬ä¸€å¥æè¿°ï¼Œå› ä¸ºè¯¥å†…å­˜æ–‡ä»¶ç³»ç»Ÿå¹¶æœªå¼•å…¥æƒé™é—®é¢˜ã€‚è¯·ç‰¹åˆ«å…³æ³¨è¿”å›å€¼æè¿°ï¼Œå¹¶å¯¹ä¸åˆç†çš„è¾“å…¥åšåˆé€‚çš„å¤„ç†ï¼Œå…·ä½“è€Œè¨€ï¼Œä½ éœ€è¦é’ˆå¯¹æ–‡æ¡£ä¸­`EEXIST`,`EINVAL`,`ENOENT`,`ENOTDIR`(å‰ä¸€ä¸ªï¼Œåä¸€ä¸ªæ˜¯å› ä¸ºè¯¥æ–‡ä»¶ç³»ç»Ÿæœªå¼•å…¥ç›¸å¯¹è·¯å¾„)ã€‚**

##### ropen

è¯¥å‡½æ•°å¯¹åº”äº[å‰æ–‡](#RefToSysFunc)æåˆ°çš„`open`å‡½æ•°ï¼Œåœ¨Linuxç³»ç»Ÿä¸‹ä½ å¯ä»¥åˆ©ç”¨å‘½ä»¤`man 2 open`æŸ¥çœ‹å…¶æ–‡æ¡£ã€‚

**ä½ éœ€è¦å®ç°çš„å†…å®¹åŒ…å«ï¼šæ–‡æ¡£ä¸­çš„å‰ä¸¤æ®µæè¿°å’Œè¿”å›å€¼æè¿°ï¼Œå…³äºæ ‡å¿—ä½éƒ¨åˆ†çš„å†…å®¹ï¼Œå‰æ–‡å·²ç»ä¸ºä½ æ€»ç»“äº†ã€‚ä½ éœ€è¦å¯¹ä¸åˆç†çš„è¾“å…¥åšåˆé€‚çš„å¤„ç†ï¼Œå…·ä½“è€Œè¨€ï¼Œä½ éœ€è¦é’ˆå¯¹æ–‡æ¡£ä¸­`EINVAL`å’Œ`ENONENT`ï¼ˆå‰ä¸¤ä¸ªï¼‰çš„æè¿°è¿›è¡Œé”™è¯¯å¤„ç†ï¼Œè¯·æ³¨æ„ï¼Œä¸ºäº†ç®€æ´èµ·è§ï¼Œä½ ä¸éœ€è¦å¯¹`EISDIR`è¿›è¡Œå¤„ç†ï¼Œæµ‹è¯•æ•°æ®ä¿è¯ä¸ä¼šå‡ºç°æ­¤ç±»æƒ…å†µã€‚**

ä¸ºäº†ç®€åŒ–å¤§å®¶å®ç°æ­¤è¿‡ç¨‹ï¼Œæˆ‘ä»¬çº¦å®šæ•°æ®ä¸­å¯èƒ½å­˜åœ¨çš„flagç»„åˆåŒ…æ‹¬ï¼š

- O_CREATï¼šä»…åˆ›å»º
- O_RDONLY: ä»…å¯è¯»
- O_WRONLY: ä»…å¯å†™
- O_RDWRï¼šå¯è¯»å†™
- O_CREAT | O_RDWRï¼šåˆ›å»ºä¸è¯»å†™
- O_CREAT | O_RDONLYï¼šåˆ›å»ºä¸åªè¯»
- O_CREAT | O_WRONLYï¼šåˆ›å»ºä¸åªå†™
- O_CREAT | O_RDWR | O_WRONLYï¼šåˆ›å»ºä¸åªå†™ï¼ˆè§å‰æ–‡è¯´æ˜ï¼‰
- O_APPEND | O_RDWRï¼šè¿½åŠ å¯è¯»å†™ï¼ˆ**è¿½åŠ æ—¶åªéœ€è¦åœ¨openæ—¶è®¾ç½®offsetå³å¯ï¼Œä¹‹åçš„writeä¸éœ€è¦å†è®¾ç½®offsetï¼Œå¯ä»¥å‚è€ƒæ ·ä¾‹4**ï¼‰
- O_APPEND | O_WRONLYï¼šè¿½åŠ ä¸åªå†™
- O_TRUNC | O_WRONLY | O_RDWRï¼šè¦†ç›–ä¸åªå†™ï¼ˆè§å‰æ–‡è¯´æ˜ï¼‰

##### rseek

è¯¥å‡½æ•°å¯¹åº”äº[å‰æ–‡](#RefToSysFunc)æåˆ°çš„`lseek`å‡½æ•°ï¼Œåœ¨Linuxç³»ç»Ÿä¸‹ä½ å¯ä»¥åˆ©ç”¨å‘½ä»¤`man 2 lseek`æŸ¥çœ‹å…¶æ–‡æ¡£ã€‚

**ä½ éœ€è¦å®ç°çš„å†…å®¹åŒ…å«ï¼šæ–‡æ¡£ä¸­çš„ç¬¬ä¸€æ®µæè¿°ï¼Œå³åªéœ€è¦è€ƒè™‘å‰ä¸‰ç§whenceï¼Œé¡¹ç›®æ¡†æ¶å·²ç»ä¸ºä½ é¢„è®¾äº†è¿™ä¸‰ç§whenceçš„å¸¸é‡å€¼ï¼Œä½ å¯ä»¥åœ¨ramfs.hæ–‡ä»¶ä¸­æ‰¾åˆ°å®ƒä»¬çš„å®šä¹‰ã€‚è™½ç„¶æµ‹è¯•æ•°æ®ä¿è¯è¾“å…¥ä¸ä¼šåŒ…å«æ— æ•ˆçš„whenceï¼Œä½†ä½ ä»ç„¶éœ€è¦å¯¹ä¸åˆç†çš„è¾“å…¥åšåˆé€‚çš„å¤„ç†ï¼Œå…·ä½“è€Œè¨€ï¼Œä½ åªéœ€è¦å¤„ç†`EINVAL`é”™è¯¯ï¼Œå…¶ä½™æƒ…å†µè¿”å›0å³å¯ã€‚**

##### rread

è¯¥å‡½æ•°å¯¹åº”äº[å‰æ–‡](#RefToSysFunc)æåˆ°çš„`read`å‡½æ•°ï¼Œåœ¨Linuxç³»ç»Ÿä¸‹ä½ å¯ä»¥åˆ©ç”¨å‘½ä»¤`man 2 read`æŸ¥çœ‹å…¶æ–‡æ¡£ã€‚

**ä½ éœ€è¦å®ç°çš„å†…å®¹åŒ…å«ï¼šæ–‡æ¡£ä¸­çš„å‰ä¸¤æ®µæè¿°ï¼Œå³ä¸éœ€è¦è€ƒè™‘è¯»å–0ä¸ªå­—èŠ‚çš„æƒ…å†µã€‚è¯·ç‰¹åˆ«å…³æ³¨è¿”å›å€¼æè¿°ï¼Œå¹¶å¯¹ä¸åˆç†çš„è¾“å…¥åšåˆé€‚çš„å¤„ç†ï¼Œå…·ä½“è€Œè¨€ï¼Œä½ éœ€è¦é’ˆå¯¹æ–‡æ¡£ä¸­`EBADF`å’Œ`EISDIR`è¿›è¡Œå¤„ç†ï¼Œè¯·æ³¨æ„ä½ çš„ç¨‹åºåº”è¯¥å…·å¤‡è¶³å¤Ÿçš„é²æ£’æ€§ã€‚**

##### rwrite

è¯¥å‡½æ•°å¯¹åº”äº[å‰æ–‡](#RefToSysFunc)æåˆ°çš„`write`å‡½æ•°ï¼Œåœ¨Linuxç³»ç»Ÿä¸‹ä½ å¯ä»¥åˆ©ç”¨å‘½ä»¤`man 2 write`æŸ¥çœ‹å…¶æ–‡æ¡£ã€‚

**ä½ éœ€è¦å®ç°çš„å†…å®¹åŒ…å«ï¼šæ–‡æ¡£ä¸­çš„å‰ä¸‰æ®µæè¿°å’Œè¿”å›å€¼æè¿°ä¸­çš„å‰ä¸¤æ®µã€‚åŒæ—¶ï¼Œä½ è¿˜éœ€è¦å¯¹ä¸åˆç†çš„è¾“å…¥åšåˆé€‚çš„å¤„ç†ï¼Œå…·ä½“è€Œè¨€ï¼Œä½ éœ€è¦é’ˆå¯¹æ–‡æ¡£ä¸­`EBADF`å’Œ`EISDIR`ï¼ˆæ–‡æ¡£ä¸­å¹¶æ²¡æœ‰å…·ä½“çš„æè¿°ï¼ŒæŒ‰ç…§readç±»ä¼¼åœ°å¤„ç†å³å¯ï¼‰è¿›è¡Œå¤„ç†ã€‚**

##### rclose

è¯¥å‡½æ•°å¯¹åº”äº[å‰æ–‡](#RefToSysFunc)æåˆ°çš„`close`å‡½æ•°ï¼Œåœ¨Linuxç³»ç»Ÿä¸‹ä½ å¯ä»¥åˆ©ç”¨å‘½ä»¤`man 2 close`æŸ¥çœ‹å…¶æ–‡æ¡£ã€‚

**ä½ éœ€è¦å®ç°çš„å†…å®¹åŒ…å«ï¼šå°†å½“å‰æ–‡ä»¶æè¿°ç¬¦æ ‡è®°ä¸ºä¸å¯ç”¨å³å¯ï¼Œä½†æ˜¯ä½ éœ€è¦æ³¨æ„å·²ç»è¢«æ ‡è®°ä¸å¯ç”¨çš„æ–‡ä»¶æè¿°ç¬¦å†æ¬¡è¢«ä½¿ç”¨æ—¶ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿï¼ˆä½ ä¸å¦¨ä½¿ç”¨Linuxæä¾›çš„æ¥å£å°è¯•ä¸€ä¸‹ï¼‰åŒæ—¶ï¼Œä½ éœ€è¦é’ˆå¯¹æ–‡æ¡£ä¸­çš„`EBADF`æè¿°è¿›è¡Œé”™è¯¯å¤„ç†ã€‚**

##### close_ramfs

è¯¥å‡½æ•°åŠŸèƒ½ä¸ºå›æ”¶å†…å­˜æ–‡ä»¶ç³»ç»Ÿï¼Œä½ å¯ä»¥è‡ªç”±å®Œæˆå…¶å®ç°ï¼Œä½†ä½ éœ€è¦ä¿è¯åœ¨å‡½æ•°ç»“æŸåï¼Œå†…å­˜æ–‡ä»¶ç³»ç»Ÿçš„ç©ºé—´å·²ç»è¢«å›æ”¶ï¼Œå¹¶ä¸”rootï¼ˆæ ¹ç›®å½•æŒ‡é’ˆï¼‰æŒ‡å‘ç©ºï¼ŒåŒæ ·çš„ï¼Œåœ¨å…¶ä»–ä»£ç ä¸­è¯·ä¿è¯**ä½ å›æ”¶äº†ä¸å†éœ€è¦ä½¿ç”¨çš„å†…å­˜**ã€‚

#### Shelléƒ¨åˆ†

è¿™ä¸€éƒ¨åˆ†çš„å†…å®¹å¹¶ä¸å›°éš¾ï¼Œä½†å¯ä»¥å¸®åŠ©ä½ ç†è§£Shellæ˜¯å¦‚ä½•é€šè¿‡æ–‡ä»¶ç³»ç»Ÿçš„apiä¸ºç”¨æˆ·æä¾›æœåŠ¡çš„ã€‚å‡ºäºå·¥ä½œé‡è€ƒè™‘ï¼Œæœ¬æ¬¡å¹¶æ²¡æœ‰å¼•å…¥äº¤äº’å¼çš„Shellï¼Œé¿å…äº†å¤§å®¶éœ€è¦è¿›ä¸€æ­¥è¿›è¡Œè¾“å…¥è§£æç­‰å·¥ä½œï¼Œä½†ä½ å¯ä»¥å°è¯•åœ¨é¡¹ç›®ç»“æŸåä¸ºå®ƒæ·»åŠ è¿™ä¸ªåŠŸèƒ½ï¼Œä»¥è·å¾—æ›´çœŸå®çš„ä½“éªŒã€‚

##### ç¯å¢ƒå˜é‡

æ­¤æ¬¡é¡¹ç›®ä¸­æˆ‘ä»¬ä»…è®¨è®º`PATH`ç¯å¢ƒå˜é‡ï¼Œå®ƒæ˜¯ä¸€ä¸ªç±»ä¼¼äºé“¾è¡¨çš„ç»“æ„ï¼Œå®ƒçš„æ¯ä¸€ä¸ªèŠ‚ç‚¹éƒ½ç”±ä¸€æ¡æŒ‡å‘ç›®å½•çš„ç»å¯¹è·¯å¾„ç»„æˆï¼Œå½“ç”¨æˆ·åœ¨Shellä¸­è¾“å…¥ä¸€ä¸ªéç»å¯¹è·¯å¾„æˆ–ç›¸å¯¹è·¯å¾„ï¼Œå³ä¸ä»¥`/`æˆ–`./`å¼€å¤´çš„å‘½ä»¤æ—¶ï¼ŒShellä¼šåœ¨è¿™ä¸ªé“¾è¡¨ä¸­é€ä¸€æœç´¢ï¼ŒæŸ¥çœ‹èŠ‚ç‚¹å¯¹åº”çš„ç»å¯¹è·¯å¾„ç›®å½•ä¸‹æ˜¯å¦å­˜åœ¨ç›¸åŒåç§°çš„å¯æ‰§è¡Œæ–‡ä»¶ï¼Œå¦‚æœæ‰¾åˆ°ï¼Œå°±åœæ­¢æœç´¢ï¼Œå¹¶æ‰§è¡Œå¯¹åº”çš„å¯æ‰§è¡Œæ–‡ä»¶ã€‚ä¾‹å¦‚ï¼Œlså‘½ä»¤å®é™…ä¸Šæ‰§è¡Œçš„æ˜¯/usr/bin/lsã€‚

> **æ›´æ­£**ï¼šæ³¨æ„è¿™é‡Œçš„è¯­ä¹‰æ˜¯é(ç»å¯¹è·¯å¾„æˆ–ç›¸å¯¹è·¯å¾„)

**åœ¨æœ¬æ¬¡é¡¹ç›®ä¸­ï¼Œä½ çš„Shelléœ€è¦å…ˆè¯»å–/home/ubuntu/.bashrcæ–‡ä»¶ï¼ˆå³Shellçš„é…ç½®æ–‡ä»¶ï¼‰ï¼Œè¯†åˆ«å¹¶ä¿å­˜å…¶ä¸­çš„å†…å®¹**ã€‚å€¼å¾—æŒ‡å‡ºçš„æ˜¯ï¼ŒShellçš„é…ç½®æ–‡ä»¶è¯­æ³•å¹¶ä¸å®Œå…¨ç›¸åŒï¼Œå†…å®¹ä¹Ÿå¹¶ä¸åªåŒ…å«å¯¹ç¯å¢ƒå˜é‡çš„è®¾ç½®ï¼Œæ„Ÿå…´è¶£çš„åŒå­¦å¯ä»¥è‡ªè¡Œç ”ç©¶ã€‚è¿™é‡Œæˆ‘ä»¬ä»¥bashçš„é…ç½®æ–‡ä»¶è¯­æ³•ä¸ºæ ‡å‡†ï¼Œå¹¶ä¿è¯.bashrcæ–‡ä»¶ä¸­ä»…åŒ…å«å¯¹`PATH`çš„è®¾ç½®ï¼Œå…¶è®¾ç½®è¯­æ³•å¦‚ä¸‹ï¼š

> **æ›´æ–°**ï¼šæ·»åŠ äº†ä¸‹é¢è¿™ä¸ªè®¾ç½®ç¯å¢ƒå˜é‡çš„è¯­æ³•
```bash
export PATH=/path/to
```
è¡¨ç¤ºå°†PATHè®¾ç½®ä¸º`/path/to`ï¼Œæ•°æ®ä¿è¯æ­¤è®¾ç½®è‡³å°‘åœ¨æ–‡ä»¶çš„å¼€å¤´å‡ºç°ä¸€æ¬¡ã€‚

****

```bash
export PATH=$PATH:/path/to/
```

è¯¥å¥è¡¨ç¤ºåœ¨é“¾è¡¨çš„å°¾éƒ¨æ·»åŠ `/path/to/`èŠ‚ç‚¹ï¼Œ`$PATH`è¡¨ç¤ºå–PATHä¸­å®é™…ä¿å­˜çš„å€¼ã€‚

```bash
export PATH=/path//to/:$PATH
```

è¯¥å¥è¡¨ç¤ºåœ¨é“¾è¡¨çš„é¦–éƒ¨æ·»åŠ `/path//to/`èŠ‚ç‚¹ã€‚

å®é™…ä¸Š`PATH`æ˜¯ä¸€ä¸²ç”±ç»å¯¹åœ°å€ç»„æˆï¼Œä½¿ç”¨`:`è¿›è¡Œåˆ†éš”çš„ç¬¦å·ä¸²ã€‚

##### init_shell

> **æ›´æ­£**ï¼šè¯»ä¸€ä¸‹è¿™å¥è¯å°±çŸ¥é“äº†

åœ¨æ­¤å‡½æ•°ä¸­ä½ éœ€è¦å®Œæˆå¯¹ç¯å¢ƒå˜é‡çš„è¯»å–ä¸ä¿å­˜ã€‚æˆ‘ä»¬çš„æµ‹è¯•ä»£ç ä¼šåœ¨è°ƒç”¨ä»»ä½•shellå‡½æ•°ä¹‹å‰è°ƒç”¨è¿™ä¸ªå‡½æ•°ã€‚

##### close_shell

ä¸close_ramfsç±»ä¼¼ï¼Œä½ éœ€è¦å›æ”¶shellä¸å†ä½¿ç”¨çš„å†…å­˜ã€‚æˆ‘ä»¬çš„æµ‹è¯•ä»£ç ä¼šåœ¨ä¸å†è°ƒç”¨shellå‡½æ•°ä¹‹åï¼Œåœ¨close_ramfsä¹‹å‰è°ƒç”¨è¿™ä¸ªå‡½æ•°ã€‚

##### sls

> ä»æ­¤å‡½æ•°å¼€å§‹ï¼Œåœ¨æœ¬åœ°æµ‹è¯•æ—¶ï¼Œæ¯ä¸ªå‡½æ•°éƒ½ä¼šåœ¨å¼€å¤´ä»¥çº¢è‰²å­—ä½“è¾“å‡ºå‘½ä»¤çš„å…·ä½“å†…å®¹ï¼Œå¹¶å°†å­—ä½“åˆ‡æ¢å›é»‘è‰²ï¼Œä¾¿äºä½ è¿›è¡Œè°ƒè¯•ã€‚åŒæ—¶ä½ éœ€è¦å…³æ³¨å‡½æ•°çš„è¿”å›å€¼ï¼Œå…·ä½“å¦‚ä½•è¿”å›è¯·å‚è€ƒæ–‡æ¡£ã€‚

å¯¹åº”äº`ls`å‘½ä»¤ï¼Œä½ å¯ä»¥ä½¿ç”¨å‘½ä»¤`man ls`æŸ¥çœ‹å…¶æ–‡æ¡£ï¼Œ**æˆ‘ä»¬ä¿è¯ä¼ å…¥å‚æ•°ä»…å«ä¸€ä¸ªç»å¯¹åœ°å€**ï¼Œä½ éœ€è¦æ‰“å°å‘½ä»¤æ‰§è¡Œçš„ç»“æœ

å…·ä½“è€Œè¨€ï¼Œå¦‚æœè¿™ä¸ªç»å¯¹åœ°å€ä¸­åŒ…å«äº†ä¸å­˜åœ¨çš„æ–‡ä»¶/ç›®å½•ï¼Œä½ éœ€è¦æŒ‰å¦‚ä¸‹æ ¼å¼è¾“å‡ºé”™è¯¯ä¿¡æ¯`ls: cannot access '%s': No such file or directory\n`ï¼›å¦‚æœè¿™ä¸ªç»å¯¹åœ°å€ä¸­åŒ…å«äº†ä¸€ä¸ªæ–‡ä»¶è€Œéç›®å½•ï¼Œä¾‹å¦‚/home/file/directoryï¼ˆå…¶ä¸­fileæ˜¯ä¸€ä¸ªæ–‡ä»¶ï¼‰ï¼Œä½ éœ€è¦æŒ‰å¦‚ä¸‹æ ¼å¼è¾“å‡ºé”™è¯¯ä¿¡æ¯`ls: cannot access '%s': Not a directory\n`ï¼›å¦åˆ™ï¼Œä½ éœ€è¦è¾“å‡ºè¿™ä¸ªæ–‡ä»¶/ç›®å½•ä¸‹çš„æ‰€æœ‰ï¼ˆå­ï¼‰æ–‡ä»¶ï¼Œç”¨ç©ºæ ¼éš”å¼€ï¼Œä¸éœ€è¦åœ¨æ„è¾“å‡ºçš„é¡ºåº

##### scat

å¯¹åº”äº`cat`å‘½ä»¤ï¼Œä½ å¯ä»¥ä½¿ç”¨å‘½ä»¤`man cat`æŸ¥çœ‹å…¶æ–‡æ¡£ï¼Œ**æˆ‘ä»¬ä¿è¯ä¼ å…¥å‚æ•°ä»…å«ä¸€ä¸ªç»å¯¹åœ°å€**ï¼Œä½ éœ€è¦æ‰“å°å‘½ä»¤æ‰§è¡Œçš„ç»“æœ

å…·ä½“è€Œè¨€ï¼Œå¦‚æœè¿™ä¸ªç»å¯¹åœ°å€ä¸­åŒ…å«äº†ä¸å­˜åœ¨çš„æ–‡ä»¶/ç›®å½•ï¼Œä½ éœ€è¦æŒ‰å¦‚ä¸‹æ ¼å¼è¾“å‡ºé”™è¯¯ä¿¡æ¯`cat: %s: No such file or directory\n`ï¼›å¦‚æœè¿™ä¸ªç»å¯¹åœ°å€ä¸­åŒ…å«äº†ä¸€ä¸ªæ–‡ä»¶è€Œéç›®å½•ï¼Œä¾‹å¦‚/home/file/directoryï¼ˆå…¶ä¸­fileæ˜¯ä¸€ä¸ªæ–‡ä»¶ï¼‰ï¼Œä½ éœ€è¦æŒ‰å¦‚ä¸‹æ ¼å¼è¾“å‡ºé”™è¯¯ä¿¡æ¯`cat: %s: Not a directory\n`ï¼›å¦‚æœè¿™ä¸ªç»å¯¹åœ°å€æœ€ç»ˆæŒ‡å‘ä¸€ä¸ªç›®å½•ï¼Œä½ éœ€è¦æŒ‰å¦‚ä¸‹æ ¼å¼è¾“å‡ºé”™è¯¯ä¿¡æ¯`cat: %s: Is a directory\n`ã€‚å¦åˆ™ï¼Œä½ éœ€è¦è¾“å‡ºè¿™ä¸ªæ–‡ä»¶**æ‰€æœ‰**çš„å†…å®¹ï¼ˆå¦‚æœæ–‡ä»¶ä¸­é€”åŒ…å«ä¸€ä¸ª\0æ€ä¹ˆåŠï¼Ÿï¼‰

##### smkdir

å¯¹åº”äº`mkdir`å‘½ä»¤ï¼Œä½ å¯ä»¥ä½¿ç”¨å‘½ä»¤`man mkdir`æŸ¥çœ‹å…¶æ–‡æ¡£ï¼Œ**æˆ‘ä»¬ä¿è¯ä¼ å…¥å‚æ•°ä»…å«ä¸€ä¸ªç»å¯¹åœ°å€**ï¼Œä½ éœ€è¦æ‰“å°å‘½ä»¤æ‰§è¡Œçš„ç»“æœ

å…·ä½“è€Œè¨€ï¼Œå¦‚æœè¿™ä¸ªç»å¯¹åœ°å€ä¸­åŒ…å«äº†ä¸å­˜åœ¨çš„æ–‡ä»¶/ç›®å½•ï¼Œä½ éœ€è¦æŒ‰å¦‚ä¸‹æ ¼å¼è¾“å‡ºé”™è¯¯ä¿¡æ¯`mkdir: cannot create directory '%s': No such file or directory\n`ï¼›å¦‚æœè¿™ä¸ªç»å¯¹åœ°å€ä¸­åŒ…å«äº†ä¸€ä¸ªæ–‡ä»¶è€Œéç›®å½•ï¼Œä¾‹å¦‚/home/file/directoryï¼ˆå…¶ä¸­fileæ˜¯ä¸€ä¸ªæ–‡ä»¶ï¼‰ï¼Œä½ éœ€è¦æŒ‰å¦‚ä¸‹æ ¼å¼è¾“å‡ºé”™è¯¯ä¿¡æ¯`mkdir: cannot create directory '%s': Not a directory\n`ï¼›å¦‚æœè¿™ä¸ªç»å¯¹åœ°å€æœ€ç»ˆæŒ‡å‘çš„æ–‡ä»¶/ç›®å½•å·²ç»å­˜åœ¨ï¼Œä½ éœ€è¦æŒ‰å¦‚ä¸‹æ ¼å¼è¾“å‡ºé”™è¯¯ä¿¡æ¯`mkdir: cannot create directory '%s': File exists\n`ã€‚å¦åˆ™ï¼Œä½ éœ€è¦åœ¨æŒ‡å®šä½ç½®åˆ›å»ºä¸€ä¸ªç›®å½•ï¼Œä¸éœ€è¦æ‰“å°è¾“å‡ºï¼Œæ­£ç¡®åœ°è¿”å›å³å¯ã€‚

##### stouch

å¯¹åº”äº`touch`å‘½ä»¤ï¼Œä½ å¯ä»¥ä½¿ç”¨å‘½ä»¤`man touch`æŸ¥çœ‹å…¶æ–‡æ¡£ï¼Œ**æˆ‘ä»¬ä¿è¯ä¼ å…¥å‚æ•°ä»…å«ä¸€ä¸ªç»å¯¹åœ°å€**ï¼Œä½ éœ€è¦æ‰“å°å‘½ä»¤æ‰§è¡Œçš„ç»“æœï¼Œå¦‚æœè¾“å…¥ä¸åˆæ³•ï¼Œä½ çš„ç»“æœåº”è¯¥ä¸º`No such file or directory`ã€‚

å…·ä½“è€Œè¨€ï¼Œå¦‚æœè¿™ä¸ªç»å¯¹åœ°å€ä¸­åŒ…å«äº†ä¸å­˜åœ¨çš„æ–‡ä»¶/ç›®å½•ï¼Œä½ éœ€è¦æŒ‰å¦‚ä¸‹æ ¼å¼è¾“å‡ºé”™è¯¯ä¿¡æ¯`touch: cannot touch '%s': No such file or directory\n`ï¼›å¦‚æœè¿™ä¸ªç»å¯¹åœ°å€ä¸­åŒ…å«äº†ä¸€ä¸ªæ–‡ä»¶è€Œéç›®å½•ï¼Œä¾‹å¦‚/home/file/directoryï¼ˆå…¶ä¸­fileæ˜¯ä¸€ä¸ªæ–‡ä»¶ï¼‰ï¼Œä½ éœ€è¦æŒ‰å¦‚ä¸‹æ ¼å¼è¾“å‡ºé”™è¯¯ä¿¡æ¯`touch: cannot touch '%s': Not a directory\n`ã€‚å¦‚æœè¿™ä¸ªç»å¯¹åœ°å€æœ€ç»ˆæŒ‡å‘çš„æ–‡ä»¶/ç›®å½•å·²ç»å­˜åœ¨ï¼Œä½ ä¸å¦¨å°è¯•ä¸€ä¸‹linuxç³»ç»Ÿä¼šæ€ä¹ˆåšã€‚å¦åˆ™ï¼Œä½ éœ€è¦åœ¨æŒ‡å®šä½ç½®åˆ›å»ºä¸€ä¸ªæ–‡ä»¶ï¼Œä¸éœ€è¦æ‰“å°è¾“å‡ºï¼Œæ­£ç¡®åœ°è¿”å›å³å¯ã€‚

##### secho

å¯¹åº”äº`echo`å‘½ä»¤ï¼Œä½ å¯ä»¥ä½¿ç”¨å‘½ä»¤`man echo`æŸ¥çœ‹å…¶æ–‡æ¡£ï¼Œ**æˆ‘ä»¬ä¿è¯ä¼ å…¥å‚æ•°ä»…å«ä¸€ä¸ªå­—ç¬¦ä¸²**ï¼Œè¯¥å­—ç¬¦ä¸²åªåŒ…å«å­—æ¯ï¼Œæ•°å­—ï¼Œâ€œ$â€å’Œ"\\"ï¼Œä½ éœ€è¦æ‰“å°å‘½ä»¤æ‰§è¡Œçš„ç»“æœï¼Œæç¤ºï¼š`echo`æ˜¯å¦‚ä½•å¤„ç†ç¯å¢ƒå˜é‡å’Œè½¬ä¹‰çš„ï¼Ÿä¸å¦¨è‡ªå·±è¯•è¯•çœ‹ğŸ˜‰ã€‚

##### swhich

å¯¹åº”äº`which`å‘½ä»¤ï¼Œä½ å¯ä»¥ä½¿ç”¨å‘½ä»¤`man which`æŸ¥çœ‹å…¶æ–‡æ¡£ï¼Œ**æˆ‘ä»¬ä¿è¯ä¼ å…¥å‚æ•°ä»…å«ä¸€ä¸ªå­—ç¬¦ä¸²**ï¼Œè¯¥å­—ç¬¦ä¸²åªåŒ…å«å­—æ¯ï¼Œæ•°å­—å’Œ"."ï¼Œä½ éœ€è¦æ‰“å°å‘½ä»¤æ‰§è¡Œçš„ç»“æœï¼Œå…³äºå‡½æ•°çš„è¿”å›å€¼ï¼Œä½ å¯ä»¥å°è¯•è‡ªå·±ä½¿ç”¨whichå‘½ä»¤å®šä½å­˜åœ¨å’Œä¸å­˜åœ¨çš„å‘½ä»¤ï¼Œä½ å¯ä»¥ä½¿ç”¨`echo $?`å‘½ä»¤æŸ¥çœ‹ä¸Šä¸€æ¡å‘½ä»¤çš„è¿”å›å€¼ï¼ˆlinuxçš„æ–‡æ¡£ä¸­ä¹Ÿæœ‰ç›¸åº”çš„æè¿°ï¼Œ**è¿™ä¸ªæ–¹æ³•é€‚ç”¨äºæ‰€æœ‰ä½ éœ€è¦å®ç°çš„shellå‡½æ•°**ï¼‰ã€‚

#### é€‰åšéƒ¨åˆ†*

åœ¨å†…å­˜æ–‡ä»¶ç³»ç»Ÿçš„åŸºç¡€ä¹‹ä¸Šï¼Œä½ å¯ä»¥ç»™Shellæ·»åŠ æ›´å¤šçš„åŠŸèƒ½ï¼Œä»¥ä½¿å®ƒæ›´åŠ å®Œå–„ï¼Œä½†é‰´äºé¡¹ç›®çš„éš¾åº¦å’Œå·¥ä½œé‡ï¼Œä¸‹é¢çš„æ–¹å‘ç•™ç»™æœ‰å…´è¶£çš„åŒå­¦ç»§ç»­è‡ªè¡Œæ¢ç´¢ğŸ˜‰

##### ç®¡é“

##### é‡å®šå‘

##### ping

##### ...

### è¿è¡Œ/æµ‹è¯•è¯´æ˜

ä½ å¯ä»¥åœ¨main.cä¸­ç¼–å†™æµ‹è¯•ä»£ç ï¼Œå¹¶é€šè¿‡`make run`å‘½ä»¤è¿è¡Œæµ‹è¯•ã€‚

## æäº¤è¯´æ˜

### æ•°æ®çº¦å®š

æœ¬é¢˜ä¸€å…±ç”±15ä¸ªæµ‹è¯•ç”¨ä¾‹ç»„æˆï¼Œå…¶ä¸­0-9ä¸ºå†…å­˜æ–‡ä»¶ç³»ç»Ÿéƒ¨åˆ†çš„æµ‹è¯•ï¼Œ10-14ä¸ºShelléƒ¨åˆ†çš„æµ‹è¯•ï¼Œå…¶ä¸­ç¬¬0ä¸ªæµ‹è¯•ç‚¹å’Œç¬¬14ä¸ªæµ‹è¯•ç‚¹ä¸ºè¯šä¿¡æµ‹è¯•ï¼Œå³ä½ å‡ ä¹ä»€ä¹ˆéƒ½ä¸ç”¨å¹²ï¼ˆç¬¬14ä¸ªæµ‹è¯•ç‚¹éœ€è¦ä½ å¯¹ä¸å«$çš„å­—ç¬¦ä¸²å®Œæˆechoæ“ä½œï¼‰å°±å¯ä»¥å¾—åˆ†ã€‚

#### å†…å­˜æ–‡ä»¶ç³»ç»Ÿéƒ¨åˆ†

æ•´ä¸ªâ½‚ä»¶ç³»ç»ŸåŒæ—¶å­˜åœ¨çš„æ‰€æœ‰â½‚ä»¶å†…å®¹ä¸ä¼šè¶…è¿‡ 512 MiBï¼ˆä¸å«å·²ç»åˆ å»çš„â½‚ä»¶å’Œæ•°æ®ï¼‰ï¼Œç»™äºˆ 1GiB çš„å†…å­˜é™åˆ¶ã€‚ åŒæ—¶å­˜åœ¨çš„â½‚ä»¶ä¸â½¬å½•ä¸ä¼šè¶…è¿‡ 65536 ä¸ªã€‚ åŒæ—¶æ´»è·ƒç€çš„â½‚ä»¶æè¿°ç¬¦ä¸ä¼šè¶…è¿‡ 4096 ä¸ªã€‚ 

å¯¹äºæ‰€æœ‰æ•°æ®ç‚¹ï¼Œâ½‚ä»¶æ“ä½œè¯»å†™çš„æ€»å­—èŠ‚æ•°ä¸ä¼šè¶…è¿‡ 10GiBã€‚æ—¶é™å°†ç»™åˆ°â¼€ä¸ªâ¾®å¸¸å¯è§‚çš„é‡çº§ã€‚é”™è¯¯å°†ä¼šåˆ†æ•£åœ¨å„ä¸ªæ•°æ®ç‚¹ä¸­ï¼Œä½ éœ€è¦ä¿è¯ä½ çš„ API èƒ½æ­£ç¡®åœ°åˆ¤æ–­é”™è¯¯çš„æƒ…å†µå¹¶æŒ‰ç…§è¦æ±‚çš„è¿”å›å€¼é€€å‡ºã€‚å„æ•°æ®ç‚¹çš„æ€§è´¨ï¼š

1. å¦‚åŸå§‹çš„ main.c 
2. æ ¹â½¬å½•ä¸‹å°‘é‡â½‚ä»¶åˆ›å»º + ropen + rwrite + rclose 
3. åœ¨ 2 çš„åŸºç¡€ä¸Šï¼Œæµ‹è¯• O_APPENDï¼Œrseek 
4. åœ¨ 3 çš„åŸºç¡€ä¸Šæ‰©â¼¤è§„æ¨¡ 
5. å°‘é‡â¼¦â½¬å½•åˆ›å»ºï¼ˆ<= 5 å±‚ï¼‰+ â½‚ä»¶åˆ›å»ºä¸éšæœºè¯»å†™ 
6. åœ¨ 5 çš„åŸºç¡€ä¸Šï¼Œæµ‹è¯• rrmdir, runlinkã€‚ 
7. â¼¤â½‚ä»¶æµ‹è¯•ã€‚å¤š fd å¯¹å°‘é‡â¼¤â½‚ä»¶â¼¤é‡è¯»å†™ + rseek + O_TRUNCATE 
8. å¤æ‚çš„â½‚ä»¶æ ‘ç»“æ„æµ‹è¯•ã€‚â¼¤é‡çš„ O_CREATï¼Œrmkdir, rrmdir, runlinkã€‚å°‘é‡è¯»å†™ 
9. â½‚ä»¶æè¿°ç¬¦ç®¡ç†æµ‹è¯•ã€‚â¼¤é‡ ropenã€rcloseï¼Œå¤š fd å•â½‚ä»¶ 

#### Shelléƒ¨åˆ†

æ•°æ®è§„æ¨¡æ²¿ç”¨å†…å­˜æ–‡ä»¶ç³»ç»Ÿéƒ¨åˆ†çš„è¯´æ˜ï¼Œä¸‹é¢å¯¹å„æµ‹è¯•ç‚¹çš„æ€§è´¨è¿›è¡Œè¯´æ˜ï¼š

10. å¤šå±‚ç›®å½•å’Œæ–‡ä»¶çš„æ··åˆåˆ›å»ºï¼ˆsmkdir <= 3 å±‚ï¼‰ï¼Œä»¥åŠlså‘½ä»¤çš„å®ç°ï¼ˆä½ ä¸éœ€è¦è€ƒè™‘lsçš„è¾“å‡ºé¡ºåºï¼Œwe have special judgeï¼‰
11. åˆ›å»ºæ–‡ä»¶ï¼Œè¯»å†™æ–‡ä»¶ï¼Œç¯å¢ƒå˜é‡ç»¼åˆæµ‹è¯•
12. åœ¨11çš„åŸºç¡€ä¸ŠåŠ å¼ºå¯¹ç¯å¢ƒå˜é‡çš„æ‹·æ‰“ï¼ˆæ³¨æ„å…³æ³¨exportè¯­æ³•æ–°å¢äº†ä¸€æ¡è§„åˆ™ï¼‰
13. é›†ä¸­æµ‹è¯•å„ç§é”™è¯¯çš„å¤„ç†æ˜¯å¦æ­£ç¡®

### æäº¤æ–¹å¼

> **æ›´æ­£**ï¼šåœ¨ä½ æäº¤ä»£ç ä¹‹å‰ï¼Œè¯·åŠ¡å¿…æ³¨æ„å°†shell.cçš„å‰å‡ è¡Œä¿®æ”¹ä¸ºå¦‚ä¸‹ï¼š
```c
#include "ramfs.h"
#include "shell.h"
#ifndef ONLINE_JUDGE
  #define print(...) printf("\033[31m");printf(__VA_ARGS__);printf("\033[0m");
#else
  #define print(...) 
#endif
```

æ¨èåœ¨OJå¹³å°ä¸Šç‚¹å‡»æäº¤ä»£ç è·å–TOKENï¼Œç„¶ååœ¨Makefileä¸­æ‰¾åˆ°submitç›®æ ‡ï¼Œåœ¨ç¬¬å››è¡Œæ·»åŠ ï¼ˆç”¨ä½ è·å–åˆ°çš„tokenæ›¿æ¢`${your token}`ï¼‰ï¼š

```makefile
$(eval TOKEN := ${your token})
```
ç„¶ååœ¨ç»ˆç«¯è¾“å…¥`make submit`å³å¯æäº¤ã€‚

### æµ‹è¯•æ ·ä¾‹

#### æ ·ä¾‹1

ç”±äºshellåœ¨æ–‡ä»¶ç³»ç»Ÿçš„åŸºç¡€ä¹‹ä¸Šï¼Œæ‰€ä»¥æ”¾å‡ºè¾ƒå…¨é¢çš„æ–‡ä»¶ç³»ç»Ÿæ ·ä¾‹ï¼š

main.c

~~~~c
#include "ramfs.h"
#include "shell.h"
#include <string.h>
#include <stdlib.h>
#include <assert.h>

int notin(int fd, int *fds, int n) {
    for (int i = 0; i < n; i++) {
    if (fds[i] == fd) return 0;
    }
    return 1;
}
int genfd(int *fds, int n) {
    for (int i = 0; i < 4096; i++) {
    if (notin(i, fds, n))
    return i;
    }
    return -1;
}
int main() {
    init_ramfs();
    int fd[10];
    int buf[10];
    assert(ropen("/abc==d", O_CREAT) == -1);
    assert((fd[0] = ropen("/0", O_RDONLY)) == -1);
    assert((fd[0] = ropen("/0", O_CREAT | O_WRONLY)) >= 0);
    assert((fd[1] = ropen("/1", O_CREAT | O_WRONLY)) >= 0);
    assert((fd[2] = ropen("/2", O_CREAT | O_WRONLY)) >= 0);
    assert((fd[3] = ropen("/3", O_CREAT | O_WRONLY)) >= 0);
    assert(rread(fd[0], buf, 1) == -1);
    assert(rread(fd[1], buf, 1) == -1);
    assert(rread(fd[2], buf, 1) == -1);
    assert(rread(fd[3], buf, 1) == -1);
    for (int i = 0; i < 100; i++) {
      assert(rwrite(fd[0], "\0\0\0\0\0", 5) == 5);
      assert(rwrite(fd[1], "hello", 5) == 5);
      assert(rwrite(fd[2], "world", 5) == 5);
      assert(rwrite(fd[3], "\x001\x002\x003\x0fe\x0ff", 5) == 5);
    }
    assert(rclose(fd[0]) == 0);
    assert(rclose(fd[1]) == 0);
    assert(rclose(fd[2]) == 0);
    assert(rclose(fd[3]) == 0);
    assert(rclose(genfd(fd, 4)) == -1);
    assert((fd[0] = ropen("/0", O_CREAT | O_RDONLY)) >= 0);
    assert((fd[1] = ropen("/1", O_CREAT | O_RDONLY)) >= 0);
    assert((fd[2] = ropen("/2", O_CREAT | O_RDONLY)) >= 0);
    assert((fd[3] = ropen("/3", O_CREAT | O_RDONLY)) >= 0);
    assert(rwrite(fd[0], buf, 1) == -1);
    assert(rwrite(fd[1], buf, 1) == -1);
    assert(rwrite(fd[2], buf, 1) == -1);
    assert(rwrite(fd[3], buf, 1) == -1);
    for (int i = 0; i < 50; i++) {
      assert(rread(fd[0], buf, 10) == 10);
      assert(memcmp(buf, "\0\0\0\0\0\0\0\0\0\0", 10) == 0);
      assert(rread(fd[1], buf, 10) == 10);
      assert(memcmp(buf, "hellohello", 10) == 0);
      assert(rread(fd[2], buf, 10) == 10);
      assert(memcmp(buf, "worldworld", 10) == 0);
      assert(rread(fd[3], buf, 10) == 10);
      assert(memcmp(buf, "\x001\x002\x003\x0fe\x0ff\x001\x002\x003\x0fe\x0ff", 10) == 0);
    }
    assert(rread(fd[0], buf, 10) == 0);
    assert(rread(fd[1], buf, 10) == 0);
    assert(rread(fd[2], buf, 10) == 0);
    assert(rread(fd[3], buf, 10) == 0);
    assert(rclose(fd[0]) == 0);
    assert(rclose(fd[1]) == 0);
    assert(rclose(fd[2]) == 0);
    assert(rclose(fd[3]) == 0);
    return 0;
}
~~~~

æœŸæœ›è¾“å‡ºï¼š

é™¤äº†commitä¿¡æ¯ä¹‹å¤–æ²¡æœ‰ä»»ä½•è¾“å‡º

#### æ ·ä¾‹2

ç»¼åˆæµ‹è¯•

main.c:

~~~~c
#include "ramfs.h"
#include "shell.h"
#include <string.h>
#include <stdlib.h>
#include <assert.h>

const char *content = "export PATH=/usr/bin/\n";
const char *ct = "export PATH=/home:$PATH";
int main() {
  init_ramfs();

  assert(rmkdir("/home") == 0);
  assert(rmkdir("//home") == -1);
  assert(rmkdir("/test/1") == -1);
  assert(rmkdir("/home/ubuntu") == 0);
  assert(rmkdir("/usr") == 0);
  assert(rmkdir("/usr/bin") == 0);
  assert(rwrite(ropen("/home///ubuntu//.bashrc", O_CREAT | O_WRONLY), content, strlen(content)) == strlen(content));
  
  int fd = ropen("/home/ubuntu/.bashrc", O_RDONLY);
  char buf[105] = {0};

  assert(rread(fd, buf, 100) == strlen(content));
  assert(!strcmp(buf, content));
  assert(rwrite(ropen("/home////ubuntu//.bashrc", O_WRONLY | O_APPEND), ct, strlen(ct)) == strlen(ct));
  memset(buf, 0, sizeof(buf));
  assert(rread(fd, buf, 100) == strlen(ct));
  assert(!strcmp(buf, ct));
  assert(rseek(fd, 0, SEEK_SET) == 0);
  memset(buf, 0, sizeof(buf));
  assert(rread(fd, buf, 100) == strlen(content) + strlen(ct));
  char ans[205] = {0};
  strcat(ans, content);
  strcat(ans, ct);
  assert(!strcmp(buf, ans));

  init_shell();

  assert(scat("/home/ubuntu/.bashrc") == 0);
  assert(stouch("/home/ls") == 0);
  assert(stouch("/home///ls") == 0);
  assert(swhich("ls") == 0);
  assert(stouch("/usr/bin/ls") == 0);
  assert(swhich("ls") == 0);
  assert(secho("hello world\\n") == 0);
  assert(secho("\\$PATH is $PATH") == 0);

  close_shell();
  close_ramfs();
}
~~~~

æœŸæœ›è¾“å‡ºï¼š

~~~~bash
cat /home/ubuntu/.bashrc
export PATH=/usr/bin/
export PATH=/home:$PATH
touch /home/ls
touch /home///ls
which ls
/home/ls
touch /usr/bin/ls
which ls
/home/ls
echo hello world\n
hello worldn
echo \$PATH is $PATH
$PATH is /home:/usr/bin/
~~~~

#### æ ·ä¾‹3

ä¸ºæ–¹ä¾¿å¤§å®¶äº†è§£shellçš„å‘½ä»¤éƒ½åº”è¯¥å¦‚ä½•æŠ¥é”™ï¼Œè¿™é‡Œç»™å‡ºä¸€ä¸ªæ ·ä¾‹

main.c:

~~~~c
#include "ramfs.h"
#include "shell.h"
#include <string.h>
#include <stdlib.h>
#include <assert.h>

int main() {
  init_ramfs();
  init_shell();
  
  assert(sls("/home") == 1);
  assert(scat("/home/ubuntu/.bashrc") == 1);
  assert(scat("/") == 1);
  assert(smkdir("/home") == 0);
  assert(smkdir("/test/1") == 1);
  assert(stouch("/home/1") == 0);
  assert(smkdir("/home/1/1") == 1);
  assert(stouch("/test/1") == 1);
  assert(swhich("notexist") == 1);

  close_shell();
  close_ramfs();
}
~~~~

æœŸæœ›è¾“å‡º:

~~~~
ls /home
ls: cannot access '/home': No such file or directory
cat /home/ubuntu/.bashrc
cat: /home/ubuntu/.bashrc: No such file or directory
cat /
cat: /: Is a directory
mkdir /home
mkdir /test/1
mkdir: cannot create directory '/test/1': No such file or directory
touch /home/1
mkdir /home/1/1
mkdir: cannot create directory '/home/1/1': Not a directory
touch /test/1
touch: cannot touch '/test/1': No such file or directory
which notexist
~~~~

#### æ ·ä¾‹4

è¿™æ˜¯ä¸ºO_APPENDå’ŒO_TRUNCæ ‡å¿—ä½å‡†å¤‡çš„ç®€å•æ ·ä¾‹

main.c: 

~~~~c
#include "ramfs.h"
#include "shell.h"
#include <string.h>
#include <stdlib.h>
#include <assert.h>
#include <stdio.h>

char s[105] = "Hello World!\n";
int main() {
    init_ramfs();
    init_shell();
    int fd1 = ropen("/test", O_CREAT | O_RDWR | O_APPEND);
    rwrite(fd1, s, strlen(s));
    rseek(fd1, 2, SEEK_SET);
    rwrite(fd1, s, strlen(s));

    scat("/test");

    int fd2 = ropen("/test", O_TRUNC | O_RDWR);
    
    scat("/test");
    rwrite(fd2, s, strlen(s));
    
    scat("/test");

    close_shell();
    close_ramfs();
    return 0;
}
~~~~

æœŸæœ›è¾“å‡º: 

~~~~
cat /test
HeHello World!

cat /test

cat /test
Hello World!

~~~~



